# FinGenius - Technical Deep Dive

## 1. Project Overview

FinGenius is an open-source, AI-powered financial analysis platform explicitly designed for the **Chinese A-share market**. Its primary purpose is to provide deep, structured, and validated financial analysis on individual stocks, moving beyond the limitations of general-purpose large language models (LLMs) that often suffer from "hallucination" or a lack of market-specific knowledge when applied to A-shares. The project's core philosophy is rooted in simulating a real-world, adversarial analysis process, which it achieves through its unique **Research–Battle Dual-Environment Multi-Agent Architecture**.

The platform's main features revolve around its specialized team of AI agents. These agents, such as the Hot Money Agent, Risk Control Agent, and Technical Analysis Agent, are each tasked with a specific domain of financial analysis, from reading regulatory policies to monitoring real-time large order anomalies. The system's output is a comprehensive, structured report generated after a multi-round debate among the agents, ensuring the final conclusion is robust and validated. This approach is intended to provide retail investors with an "AI financial veteran" that understands the nuances of the A-share market.

The target users are primarily **A-share investors**, particularly retail investors who seek sophisticated, in-depth analysis that is tailored to the Chinese market's unique dynamics. It is also aimed at **AI and FinTech developers** and researchers interested in multi-agent systems, game theory in AI, and the application of LLMs to specialized, high-stakes domains like finance. The project is open-source for learning and research, but the developers also offer a commercial mobile application that incorporates their proprietary "Annual Ring Memory Rule Algorithm."

## 2. Architecture Design

The FinGenius system is built on a sophisticated **Research–Battle Dual-Environment Multi-Agent Architecture**, designed to simulate a structured, adversarial financial analysis process. This architecture is a core innovation, moving beyond simple single-agent queries to a complex, collaborative, and competitive system. The entire system is implemented in Python and leverages the **Model Context Protocol (MCP)** for tool integration, inheriting from the OpenManus multi-agent framework.

The architecture is divided into two primary environments: the **Research Environment** and the **Battle Environment**. The Research Environment is responsible for the initial, in-depth data collection and analysis. It employs a team of specialized agents, such as the Sentiment Agent (舆情agent), Hot Money Agent (游资agent), and Technical Analysis Agent (技术agent), to perform parallel or sequential analysis on a given stock code. Each agent, inheriting from `MCPAgent`, is equipped with specific tools via the MCP to access professional financial data and perform specialized tasks. The results from all agents in this environment are collected and form a comprehensive, multi-faceted analysis report.

The Battle Environment takes the comprehensive report generated by the Research Environment and initiates a structured, multi-round debate among the agents. This environment is designed to simulate a "game of strategy" or **"博弈"** (game theory), where agents must use the research findings to argue for or against a position, similar to the **Prisoner's Dilemma** model mentioned in the documentation. The key feature here is the **cumulative debate mechanism**, where each agent's argument is informed by the full research context and the preceding arguments of other agents, ensuring a progressive and deep discussion. The `BattleState` class manages the debate history, agent order, and voting results. The process culminates in a final vote or decision, which is then used to generate the final structured HTML report. This dual-environment approach ensures that the final output is not just a summary of individual analyses but a synthesis derived from a structured, adversarial validation process.

## 3. Core Technologies

The FinGenius project is primarily developed in **Python 3.12+** and is built upon a modern, asynchronous foundation.

*   **Programming Language & Runtime:** **Python 3.12+** is the core language, utilizing its modern features and robust ecosystem.
*   **Agent Framework:** The system is based on the **OpenManus** multi-agent framework, which provides the foundational structure for agent creation, memory management, and tool integration.
*   **Tool Integration Protocol:** **Model Context Protocol (MCP)** is the critical technology for enabling agents to use external, professional financial tools. Agents are implemented as `MCPAgent`s, which use `fastmcp` and `mcp` libraries to connect to and utilize specialized financial data servers.
*   **LLM Integration:** The system uses the **OpenAI API** (`openai` library) for large language model interactions, with configurable models like `gpt-4o`. The configuration is managed via `config.toml` using the `tomli` library.
*   **Data Handling & Analysis:** Standard Python data science libraries are used, including **Pandas** for data manipulation, **Numpy** for numerical operations, and **Matplotlib** and **Plotly** for potential data visualization within the analysis.
*   **Web Scraping & Search:** Libraries like `beautifulsoup4`, `googlesearch-python`, `baidusearch`, and `duckduckgo_search` are used to gather real-time financial news and data from the web.
*   **Financial Data APIs:** Specialized libraries like **efinance** and **akshare** are integrated to access A-share specific financial market data.
*   **Asynchronous Operations:** **Asyncio** and **aiohttp** are used to manage concurrent operations, which is essential for running multiple agents and handling external API calls efficiently.
*   **Configuration & Logging:** **python-dotenv** is used for environment variable management, and **loguru** provides robust and flexible logging capabilities.

## 4. Key Features

FinGenius is distinguished by its innovative multi-agent architecture and its deep focus on the A-share market.

*   **Research–Battle Dual-Environment Architecture:** This is the core innovation, separating the analysis into a data-gathering **Research** phase and a structured, adversarial **Battle** debate phase, which simulates a game-theoretic approach to decision-making.
*   **A-Share Market Specialization:** The project is explicitly designed for the Chinese A-share market, addressing the "hallucination" and "water-soil incompatibility" issues common in general-purpose or US-market-focused AI financial tools.
*   **Specialized Agent Team:** It features a team of 16 (6 open-source) specialized agents, each with a distinct financial role:
    *   **Sentiment Agent (舆情agent):** Calculates sentiment factors from public opinion.
    *   **Hot Money Agent (游资agent):** Analyzes Dragon and Tiger Lists (龙虎榜).
    *   **Risk Control Agent (风控agent):** Scrutinizes policy and regulatory changes.
    *   **Technical Analysis Agent (技术agent):** Monitors position red lines and technical indicators.
    *   **Chip Agent (筹码agent):** Identifies main force behavior through chip distribution.
    *   **Large Order Anomaly Agent (大单异动agent):** Monitors real-time market movements.
*   **Cumulative Debate Mechanism:** In the Battle Environment, agents receive the full research context plus the arguments of all previous speakers in the current debate round, fostering a deeper, context-aware, and progressive discussion.
*   **"Annual Ring Memory Rule Algorithm" (年轮记忆规则算法):** A proprietary memory system mentioned in the documentation, designed to remember and adapt to the user's investment habits over time, moving beyond simple chat history.
*   **Structured HTML Report Output:** The final output is a structured report generated after the multi-agent debate, providing a synthesized and validated conclusion. Optional features include JSON output and Text-to-Speech (TTS) for the final result.

## 5. Technical Implementation Details

The technical implementation of FinGenius is a sophisticated orchestration of specialized agents within a two-stage pipeline: Research and Battle.

### Agent Design and Hierarchy
All agents in FinGenius inherit from a base hierarchy: `BaseAgent` -> `ReActAgent` -> `ToolCallAgent` -> `MCPAgent`.
*   **`BaseAgent`**: Provides core functionalities like memory (`Memory` class), LLM interaction (`LLM` class), and state management.
*   **`ReActAgent`**: Implements the **ReAct (Reasoning and Acting)** pattern, allowing the agent to alternate between internal thought and external action.
*   **`ToolCallAgent`**: Extends ReAct by managing available tools and handling tool calls, which are critical for accessing external data.
*   **`MCPAgent`**: The final layer, which connects to and utilizes tools via the **Model Context Protocol (MCP)** using `MCPClients`. Specialized agents like `SentimentAgent` and `RiskControlAgent` inherit from `MCPAgent`, giving them access to their domain-specific financial tools.

### Data Flow and Processing Pipeline
The data flow is strictly sequential through the two environments:

1.  **Input and Initialization**: The user initiates the process with a stock code (`python main.py 000001`). The `main.py` script initializes the `ResearchEnvironment` and the team of agents.
2.  **Research Phase**: The `ResearchEnvironment.run(stock_code)` method executes the team of agents. Each agent performs its specialized analysis, often involving:
    *   **Tool Call**: The agent uses its `MCPAgent` capabilities to call an external financial tool (e.g., `akshare` via MCP) to fetch real-time data.
    *   **LLM Reasoning**: The agent uses the fetched data and its system prompt to reason and generate a partial analysis.
    *   **Memory Update**: The agent updates its internal memory with the steps and findings.
    *   The environment collects all individual analysis results into a comprehensive `research results` dictionary.
3.  **Battle Phase**: The `BattleEnvironment.run(research_results)` method is called. The full `research results` are passed to all agents in the Battle Environment.
    *   **Structured Debate**: The environment runs a loop for a configurable number of `debate-rounds`. In each round, agents speak in a defined order. The key is the **cumulative context**: before an agent speaks, the environment builds a context string that includes the full research report and the speeches of all preceding agents in the current round.
    *   **Decision and Output**: After the debate rounds, a final voting process occurs. The `BattleEnvironment` synthesizes the debate and voting results into a final decision or conclusion.
4.  **Final Output**: The final result is formatted (e.g., HTML or JSON) by a `ReportAgent` or the main script and presented to the user.

### Code Structure
The project structure is modular, reflecting the architectural components:

```
FinGenius/
├── agents/                 # Definitions for all specialized agents (SentimentAgent, HotMoneyAgent, etc.)
├── environments/           # Core environment logic (BaseEnvironment, ResearchEnvironment, BattleEnvironment)
├── tools/                  # Tool definitions and MCP client management (MCPClients)
├── core/                   # Base classes and utilities (BaseAgent, LLM, Memory, State management)
├── config/                 # Configuration files (config.example.toml)
├── docs/                   # Documentation and assets (architecture diagrams, logo)
├── main.py                 # Entry point for the application
├── requirements.txt        # Project dependencies
└── ...
```
This structure clearly separates the concerns: `agents` define the roles, `environments` define the interaction protocols, and `tools` manage external capabilities. The `core` directory holds the foundational abstractions that enable the multi-agent system. The `main.py` script acts as the orchestrator, managing the flow between the Research and Battle environments.

## 6. Key Dependencies

The project relies on a comprehensive set of Python packages to handle agent orchestration, LLM interaction, data analysis, and financial data access.

*   **LLM & Agent Core:** `openai`, `tiktoken`, `tenacity`, `pydantic` for LLM communication, token management, retry logic, and data validation.
*   **Multi-Agent & Tooling:** `mcp`, `fastmcp` for the Model Context Protocol, enabling agents to call external financial tools.
*   **Data Science:** `pandas`, `numpy`, `matplotlib`, `plotly` for data manipulation, numerical computing, and visualization.
*   **Financial Data:** `efinance`, `akshare` for accessing specific A-share market data.
*   **Web & Async:** `aiohttp`, `requests`, `beautifulsoup4` for asynchronous web requests and HTML parsing, and `asyncio` for concurrency.
*   **Search & Scraping:** `googlesearch-python`, `baidusearch`, `duckduckgo_search` for real-time information retrieval.
*   **Utilities:** `loguru`, `tomli`, `python-dotenv`, `rich` for logging, configuration file parsing, environment variable management, and rich terminal output.

## 7. Use Cases

FinGenius is designed for several key application scenarios within the A-share financial market:

*   **In-Depth Stock Analysis and Due Diligence:** A user can input a stock code (e.g., `000001`) and receive a comprehensive, multi-perspective report. This is the primary use case, where the system's specialized agents analyze the stock from technical, sentiment, and risk control angles, culminating in a validated conclusion from the adversarial debate.
*   **Real-Time Market Monitoring and Anomaly Detection:** The system can be used to monitor specific stocks for sudden changes. The **Large Order Anomaly Agent** and **Sentiment Agent** are specifically tasked with monitoring real-time market dynamics and public opinion, providing an early warning system for unusual activity.
*   **Structured Financial Research and Education:** Researchers and students can use the platform to understand how different financial factors interact. The structured output, which includes the raw analysis from the Research phase and the arguments from the Battle phase, serves as an educational tool to trace the decision-making process of the AI agents.
*   **Personalized Investment Habit Tracking (Commercial Feature):** While the open-source version focuses on analysis, the commercial mobile application highlights the use case of personalized advice through the "Annual Ring Memory Rule Algorithm," which tracks and adapts to the user's investment history and habits.
*   **Tool Integration and Extensibility Testing:** For developers, the project serves as a robust example of integrating external tools via the Model Context Protocol (MCP). It can be used as a testbed for integrating new financial data sources or analytical models as custom tools for the agents.

## 8. Strengths & Limitations

**Strengths**

The primary strength of FinGenius lies in its **Research–Battle Dual-Environment Multi-Agent Architecture**. This game-theoretic approach, which subjects initial research to a structured, adversarial debate, significantly enhances the reliability and depth of the final analysis, mitigating the risk of LLM "hallucination." Its explicit focus on the **Chinese A-share market** is a major technical advantage, as it integrates specialized data sources (`akshare`, `efinance`) and domain knowledge to provide relevant, high-quality analysis that general-purpose tools cannot match. The system's modular design, based on the **OpenManus** framework and **MCP** for tool integration, makes it highly extensible. New agents and professional tools can be easily added by adhering to the MCP standard, future-proofing the platform's analytical capabilities. Furthermore, the use of modern Python features and asynchronous programming (`asyncio`, `aiohttp`) ensures high performance and concurrency, which is crucial for real-time financial data processing.

**Limitations**

The project's main limitation is its **heavy reliance on external Large Language Models (LLMs)**, specifically the OpenAI API (e.g., `gpt-4o`). This introduces a dependency on a third-party service, incurring costs and potential latency issues. The specialized nature of the project, while a strength for A-share users, makes it **less applicable to other markets** (e.g., US, European) without significant modification and integration of new market-specific data tools. The core innovation, the "Annual Ring Memory Rule Algorithm," is mentioned as being in the commercial app, suggesting the open-source version may lack this advanced, personalized memory feature. Finally, the complexity of the dual-environment, multi-agent system introduces a **higher barrier to entry** for new developers compared to simpler single-agent applications.

## 9. GitHub Repository

[https://github.com/HuaYaoAI/FinGenius](https://github.com/HuaYaoAI/FinGenius)
